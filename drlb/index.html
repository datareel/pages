<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="DataReel Software Development">
    <meta name="author" content="DataReel Software Development">
    <meta name="title" content="DataReel OpenSource" />
    <meta name="creator" content="DataReel Software Development" />
    <meta name="publisher" content="DataReel Software Development" />
    <meta name="contributor" content="DataReel Software Development" />
    <meta name="date.created" scheme="ISO8601" content="2016-08-20" />
    <meta name="date.reviewed" scheme="ISO8601" content="2016-08-20" />
    <meta name="language" scheme="DCTERMS.RFC1766" content="EN-US" />
    <meta name="keywords" content="Database, Linux, Applications, load
				   balancer, cluster manager,
				   Communications, Sockets, Threads, C++,
				   Programming, Windows, open source,
				   multi-threaded, cross-platform,
				   commercial, individual, academic, 
				   modular" />
    <meta name="rights" content="http://datareel.com" />
    <meta name="rating" content="General" />
    <meta name="Distribution" content="Global" />
    <meta name="Revisit-after" content="1 week">
    <meta name="robots" content="index,follow" />
    <link rel="icon" href="../images/favicon.ico">
    <title>Load Balancer</title>
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/ie10-viewport-bug-workaround.css" rel="stylesheet">
    <link href="../css/starter-template.css" rel="stylesheet">
    <script src="../js/ie-emulation-modes-warning.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements
    and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed"
          data-toggle="collapse" data-target="#navbar"
          aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://datareel.com/">DataReel Open Source</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="../clib/index.html">C/C++ Library</a></li>
            <li><a href="../drcm/index.html">Cluster Manager</a></li>
            <li class="active"><a href="index.html">Load Balancer</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">

      <div>
<!-- My Content Starts Below -->

<!-- Start company logo -->
<center><img src="../images/drlogo1.jpg" /></center>
<!-- End company logo --><!-- Start Menu -->
<hr color="#000000" noshade="noshade" size="1" /><!-- Begin Title Bar --
				-- -->
<table border="0" cellpadding="0" width="100%">
  <tbody>
    <tr>
      <td bgcolor="A0CCFF"><font face="Arial,Helvetica,Sans-serif"><b>&nbsp;Contents</b></font></td>
      </tr>
    </tbody>
</table>
<br />
<!-- End Title Bar -->

<p>
<a href="#Overview">Overview</a><br />
<a href="#WhyAnotherLoadBalancer">Why Another Load Balancer</a><br />
<a href="#Building">Building</a><br />
<a href="#Installing">Installing</a><br />
<a href="#LinuxKernelTuning">Linux Kernel Tuning</a><br />
<a href="#TestingwithApache">Testing with Apache</a><br />
<a href="#Remainingworkonthisproject">Remaining work on this project</a><br />
<a href="#SupportandBugTracking">Support and Bug Tracking</a><br />

<!-- Begin Title Bar -->
<table border="0" cellpadding="0" width="100%">
  <tbody>
    <tr>
      <td bgcolor="A0CCFF"><font face="Arial,Helvetica,Sans-serif"><b>&nbsp;<a name="Overview">Overview</a></b></font></td>
    </tr>
  </tbody>
</table>
<!-- End Title Bar -->
<br />
<p>
The DataReel load balancer (LB) is a software based TCP load balancing
solution designed to run on Linux operating systems. The DRLB project
was designed to handle a large number of persistent TCP connections,
specifically for the unidata Local Data Manager (LDM) protocol. The
DRLB source code is distributed as an open source project under the
GNU general public license. DRLB is an adaptive load balancing
environment where the source code can be modified to meet the needs of
your server and network environment. 
</p>
<p class="pull-left"><a href="#">Back to top</a></p>

<!-- Begin Title Bar -->
<table border="0" cellpadding="0" width="100%">
  <tbody>
    <tr>
      <td bgcolor="A0CCFF"><font face="Arial,Helvetica,Sans-serif"><b>&nbsp;<a name="WhyAnotherLoadBalancer">Why Another Load Balancer</a></b></font></td>
    </tr>
  </tbody>
</table>
<!-- End Title Bar -->
<br />
<p>
Most of the readily available load balancing packages are designed for
HTTP traffic, serving Web pages. DRLB was initially designed for
persistent TCP connections where the client/server connections must
remain connected and transfer bi-directional data of varying
size. HTTP connections frequently connect and disconnect and work well
with round robin and weighted round robin load balancing. In the case
of persistent connections the load balancer must be able to
dynamically assign  nodes to specific clients and distribute traffic
based on the percent of persistent connections. DRLB allows systems
administrators to dynamically route IP addresses to specific backend
nodes, with the ability to automatically fail over to other nodes. The
second design phase of DRLB was targeted at HTTP servers used as Web
page and data servers. Many data sources on FTP servers were converted
to HTTP or HTTPS downloads. In cases where existing HTTP servers were
used due to limited public IP address space, many contention issues
with server resources resulted. Web page users experienced massive
slow downs rendering Web pages while competing with data downloads on
the same server. Using DRLB in distributed/assigned mode allows the
data downloads to be isolated from the Web pages, still using only one
public Web server IP address.
</p>
<p class="pull-left"><a href="#">Back to top</a></p>

<!-- Begin Title Bar -->
<table border="0" cellpadding="0" width="100%">
  <tbody>
    <tr>
      <td bgcolor="A0CCFF"><font face="Arial,Helvetica,Sans-serif"><b>&nbsp;<a name="Building">Building</a></b></font></td>
    </tr>
  </tbody>
</table>
<!-- End Title Bar -->
<br />
<p>
Developers, follow the instructions below to build the DRLB server:
<pre>
$ cd $HOME
$ mkdir -pv git
$ cd $HOME/git
$ git clone https://github.com/datareel/datareel
$ source $HOME/git/datareel/env/gnu_env.sh
$ cd $HOME/git/datareel/load_balancer/drlb_server
$ make
</pre>
Build a default configuration to test with:
<pre>
$ ./drlb_server --verbose --debug --config-file=/tmp/lb_test_config.cfg
</pre>
The default configuration file is set up for 4 back end nodes running
Apache and the frontend LB listening on port 8080. NOTE: For testing
port 8080 is used so the LB server can be started without root
privileges. The default configuration file is documented with
comments. As set of example config files in the etc directory: 
<pre>
$ ls -l $HOME/git/datareel/load_balancer/etc
</pre>
Once your configuration is set up, run a test with debug and logging enabled:
<pre>
$ ./drlb_server --verbose --debug --config-file=/tmp/lb_test_config.cfg --log-file=/tmp/lb_test.log
</pre>
</p>
<p class="pull-left"><a href="#">Back to top</a></p>

<!-- Begin Title Bar -->
<table border="0" cellpadding="0" width="100%">
  <tbody>
    <tr>
      <td bgcolor="A0CCFF"><font face="Arial,Helvetica,Sans-serif"><b>&nbsp;<a name="Installing">Installing</a></b></font></td>
    </tr>
  </tbody>
</table>
<!-- End Title Bar -->
<br />
<p>
The development version can be installed on CENTOS6/RHEL6 or
CENTOS7/RHEL7 from the makefile:
<pre>
$ cd $HOME/git/datareel/load_balancer/drlb_server
$ sudo su -c &#39;make install_root&#39;
</pre>
</p>
<p class="pull-left"><a href="#">Back to top</a></p>

<!-- Begin Title Bar -->
<table border="0" cellpadding="0" width="100%">
  <tbody>
    <tr>
      <td bgcolor="A0CCFF"><font face="Arial,Helvetica,Sans-serif"><b>&nbsp;<a name="LinuxKernelTuning">Linux Kernel Tuning</a></b></font></td>
    </tr>
  </tbody>
</table>
<!-- End Title Bar -->
<br />
<p>
Load balancing will require kernel tuning based the volume of traffic
and type of TCP service you are load balancing. NOTE: The values in
listed below are based on extremely high volume. Depending on your
application you may not need to set many of the parameters listed. But
please keep in mind that you will need to tune the kernel for any
server acting as a load balancer. 
<br /><br />
All setting listed below must be application tested and set based on
the number of connections to your frontend LB and backend hosts. For
each of the settings below use the sysctl command to backup the
orginal changes before making any changes, for example:
<br /><br />
# sysctl fs.file-max | tee -a /root/sysctl_org_settings.txt
<br /><br />
To make the changes persistent, add the setting(s) to the sysctl.conf
file: 
<br /><br />
CENTOS 5/6 or RHEL 5/6:<br />
# vi /etc/sysctl.conf
<br /><br />
CENTOS 7 or RHEL 7:<br />
# vi /usr/lib/sysctl.d/00-system.conf
<br /><br />
To load changes CENTOS 5/6 or RHEL 5/6:<br />
# sysctl -p
<br /><br />
To load changes CENTOS 7 or RHEL 7:<br />     
# sysctl -p  /usr/lib/sysctl.d/00-system.conf
<pre>
File Handle Limits:
------------------
Increase the maximum number of open file descriptors:

fs.file-max = 25000000

IPv4 Socket Tuning:
------------------
For a large numbers of concurent sessions:

net.ipv4.ip_local_port_range = 1024 65535
net.ipv4.tcp_tw_recycle = 1
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_fin_timeout = 60
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
net.ipv4.tcp_max_syn_backlog = 4096
net.ipv4.tcp_syncookies = 1
net.core.somaxconn = 1024

IPv4 Settings:

net.ipv4.ip_forward = 1
net.ipv4.ipfrag_max_dist = 4096
net.ipv4.ip_nonlocal_bind=1

Process Scheduler:
-----------------
Increase time for process run time before the kernel will consider
migrating it again to another core: 

CENTOS 5/6 or RHEL 5/6:

kernel.sched_migration_cost = 5000000

CENTOS 7 or RHEL 7:

kernel.sched_migration_cost_ns = 5000000

kernel.sched_autogroup_enabled = 0

Threads:
-------
Increase maximum number of threads that can be created by a process:

kernel.threads-max = 5000000
vm.max_map_count = 128000
kernel.pid_max = 65536
</pre>
</p>
<p class="pull-left"><a href="#">Back to top</a></p>

<!-- Begin Title Bar -->
<table border="0" cellpadding="0" width="100%">
  <tbody>
    <tr>
      <td bgcolor="A0CCFF"><font face="Arial,Helvetica,Sans-serif"><b>&nbsp;<a name="TestingwithApache">Testing with Apache</a></b></font></td>
    </tr>
  </tbody>
</table>
<!-- End Title Bar -->
<br />
<p>
A simple way to test your DRLB server to use Apache on KVM virtual
machines. Once you have Apache running on a one or more virtual
machines copy the following PHP scripts to the Web root on each VM,
for example 
</pre>
$ cd $HOME/git/datareel/load_balancer/apache_test
$ chmod 644 *.php

$ for s in 192.168.122.111 192.168.122.112 192.168.122.113 192.168.122.114 
&gt; do
&gt; scp -p *.php root@${s}:/var/www/html/.
&gt; done

$ cd $HOME/git/datareel/load_balancer/drlb_server
$ ./drlb_server --config-file=../etc/http_rr_test.cfg --log-file=/tmp/http_rr.log &gt; /tmp/drlb_start.log &amp;
</pre>
To connect using wget, assuming the DRLB server is listening on port
8080 on the bare metal host:
<pre>
$ cd /tmp
$ wget -O index.html http://192.168.122.1:8080
</pre>
Persistent TCP connection:
<pre>
$ wget -O loop1.txt http://192.168.122.1:8080
</pre>
NOTE: If you testing using Firefox, you will be limited to 6
persistent session. By default Firefox only allow 6 simultaneous
downloads. To
increase this limit for testing, enter the following URL: 
<br /><br />
about:config
<br /><br />
Search for:
<br /><br />
network.http.max-persistent-connections-per-server
<br /><br />
Change the default from 6 to a higher number.
</p>
<p class="pull-left"><a href="#">Back to top</a></p>

<!-- Begin Title Bar -->
<table border="0" cellpadding="0" width="100%">
  <tbody>
    <tr>
      <td bgcolor="A0CCFF"><font face="Arial,Helvetica,Sans-serif"><b>&nbsp;<a name="Remainingworkonthisproject">Remaining work on this project</a></b></font></td>
    </tr>
  </tbody>
</table>
<!-- End Title Bar -->
<br />
<p>
The first DRLB release was successfully tested at National Weather
Service (NWS), Southern Region Headquarters (SRH). The implementation
phase at NWS/SRH include LDM and HTTP services using the DRLB server
to handle a high volume of TCP traffic. During the implementation
phase all source code changes and bug fixes will be release in this
open source distribution.  
<br /><br />
Remaining work to be added to this open source project:
<ul>
<li>RPM install for CENTOS/RHEL 6.X and 7.X</li>
</ul>
</p>
<p class="pull-left"><a href="#">Back to top</a></p>

<!-- Begin Title Bar -->
<table border="0" cellpadding="0" width="100%">
  <tbody>
    <tr>
      <td bgcolor="A0CCFF"><font face="Arial,Helvetica,Sans-serif"><b>&nbsp;<a name="SupportandBugTracking">Support and Bug Tracking</a></b></font></td>
    </tr>
  </tbody>
</table>
<!-- End Title Bar -->
<br />
<p>
<a href="https://github.com/datareel/datareel/issues">https://github.com/datareel/datareel/issues</a>
</p>
<p class="pull-left"><a href="#">Back to top</a></p>

<br />
<hr color="#000000" noshade="noshade" size="1" /><!-- Start Copyright Information -->
<p><font color="000000">Copyright &copy; 2001-2016&nbsp;DataReel OpenSource</font></p>

	
<!-- My Content Ends Above -->
      </div>
    </div><!-- /.container -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster
    -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery ||
    document.write('<script src="../js/vendor/jquery.min.js"><\/script>')</script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>
